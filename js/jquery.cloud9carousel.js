!function(t){function i(i,e){(i.item=this).image=i,this.fullWidth=i.width,this.fullHeight=i.height,this.alt=i.alt,this.title=i.title,t(i).css("position","absolute"),e&&(this.reflection=t(t(this.image).reflect(e)).next()[0],this.reflection.fullHeight=t(this.reflection).height(),t(this.reflection).css("margin-top",e.gap+"px"),t(this.reflection).css("width","100%"),t(this.image).css("width","100%"),this.image.parentNode.item=this.image.item),this.moveTo=function(t,i,s){this.width=this.fullWidth*s,this.height=this.fullHeight*s,this.x=t,this.y=i,this.scale=s;var n,o=(e?this.image.parentNode:this.image).style;o.width=this.width+"px",o.left=t+"px",o.top=i+"px",o.zIndex=""+100*s|0,e?(n=e.gap*s,o.height=this.height+this.reflection.fullHeight*s+"px",this.reflection.style.marginTop=n+"px"):o.height=this.height+"px"}}function e(e,s){var n=this;this.items=[],this.xCentre=null===s.xPos?.5*e.width():s.xPos,this.yCentre=null===s.yPos?.1*e.height():s.yPos,this.xRadius=null===s.xRadius?e.width()/2.3:s.xRadius,this.yRadius=null===s.yRadius?e.height()/6:s.yRadius,this.farScale=s.farScale,this.rotation=this.destRotation=Math.PI/2,this.speed=s.speed,this.frameDelay=1e3/s.FPS|0,this.frameTimer=0,this.autoPlayAmount=s.autoPlay,this.autoPlayDelay=s.autoPlayDelay,this.autoPlayTimer=0,this.onLoaded=s.onLoaded,this.onRendered=s.onRendered,s.mirrorOptions&&(this.mirrorOptions=t.extend({gap:2},s.mirrorOptions)),e.css({position:"relative",overflow:"hidden"}),this.rotateItem=function(t,i){var e=this.items[t],s=Math.sin(i),n=this.farScale,o=n+(1-n)*(s+1)*.5;e.moveTo(this.xCentre+o*(Math.cos(i)*this.xRadius-.5*e.fullWidth),this.yCentre+o*s*this.yRadius,o)},this.render=function(){for(var t=this.items.length,i=2*Math.PI/t,e=this.rotation,s=0;s<t;s++)this.rotateItem(s,e),e+=i;"function"==typeof this.onRendered&&this.onRendered(this)},this.playFrame=function(){var t=this.destRotation-this.rotation;Math.abs(t)<.001?(this.rotation=this.destRotation,this.pause()):(this.rotation+=t*this.speed,this.scheduleNextFrame()),this.render()},this.scheduleNextFrame=function(){this.frameTimer=setTimeout((function(){n.playFrame()}),this.frameDelay)},this.itemsRotated=function(){return this.items.length*(Math.PI/2-this.rotation)/(2*Math.PI)},this.floatIndex=function(){var t=this.itemsRotated()%this.items.length;return t<0?t+this.items.length:t},this.nearestIndex=function(){return Math.round(this.floatIndex())%this.items.length},this.nearestItem=function(){return this.items[this.nearestIndex()]},this.play=function(){0===this.frameTimer&&this.scheduleNextFrame()},this.pause=function(){clearTimeout(this.frameTimer),this.frameTimer=0},this.go=function(t){this.destRotation+=2*Math.PI/this.items.length*t,this.play()},this.deactivate=function(){this.pause(),clearInterval(this.autoPlayTimer),s.buttonLeft.unbind("click"),s.buttonRight.unbind("click"),e.unbind(".cloud9")},this.autoPlay=function(){this.autoPlayTimer=setInterval((function(){n.go(n.autoPlayAmount)}),this.autoPlayDelay)},this.enableAutoPlay=function(){e.bind("mouseover.cloud9",(function(){clearInterval(n.autoPlayTimer)})),e.bind("mouseout.cloud9",(function(){n.autoPlay()})),this.autoPlay()},this.bindControls=function(){s.buttonLeft.bind("click",(function(){return n.go(-1),!1})),s.buttonRight.bind("click",(function(){return n.go(1),!1})),s.mouseWheel&&e.bind("mousewheel.cloud9",(function(t,i){return n.go(0<i?1:-1),!1})),s.bringToFront&&e.bind("click.cloud9",(function(i){var e,o,h,a=t(i.target).closest("."+s.itemClass);0!==a.length&&(e=n.items.indexOf(a[0].item),o=n.items.length,h=e-n.floatIndex()%o,2*Math.abs(h)>o&&(h+=0<h?-o:o),n.destRotation=n.rotation,n.go(-h))}))};var o=e.find("."+s.itemClass);this.finishInit=function(){for(var t=0;t<o.length;t++){var s=o[t];if(void 0===s.width||void 0!==s.complete&&!s.complete)return}for(clearInterval(this.initTimer),t=0;t<o.length;t++)this.items.push(new i(o[t],this.mirrorOptions));e.bind("mousedown onselectstart",(function(){return!1})),0!==this.autoPlayAmount&&this.enableAutoPlay(),this.bindControls(),this.render(),"function"==typeof this.onLoaded&&this.onLoaded(this)},this.initTimer=setInterval((function(){n.finishInit()}),50)}t.fn.Cloud9Carousel=function(i){return this.each((function(){i=t.extend({xPos:null,yPos:null,xRadius:null,yRadius:null,farScale:.5,mirrorOptions:!1,FPS:30,speed:.13,autoPlay:0,autoPlayDelay:4e3,mouseWheel:!1,bringToFront:!1,itemClass:"cloud9-item",handle:"carousel"},i);var s=t(this);s.data(i.handle,new e(s,i))}))}}(window.jQuery||window.Zepto);